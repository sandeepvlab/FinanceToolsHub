<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Mortgage Calculator</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container">
    <h1>üè† Smart Mortgage Calculator</h1>

    <div class="card">
      <label>ZIP Code:</label>
      <input type="text" id="zipcode" placeholder="e.g. 94040">

      <label>Home Value ($):</label>
      <input type="number" id="home_value" placeholder="e.g. 500000">

      <label>Down Payment:</label>
      <div class="inline">
        <input type="number" id="down_payment_value" placeholder="e.g. 20">
        <label><input type="radio" name="dp_type" value="%" checked> %</label>
        <label><input type="radio" name="dp_type" value="$"> $</label>
      </div>

      <label>Loan Type:</label>
      <select id="loan_type" onchange="updateTerms()">
        <option value="Conventional">Conventional</option>
        <option value="ARM">ARM</option>
      </select>

      <label>Loan Term (Years):</label>
      <select id="loan_term"></select>

      <label>Property Tax ($/year):</label>
      <input type="number" id="property_tax" placeholder="e.g. 3500">

      <label>PMI (%):</label>
      <input type="number" id="pmi" placeholder="Auto" step="0.01">

      <label>Home Insurance ($/year):</label>
      <input type="number" id="home_ins" placeholder="e.g. 1200">

      <label>Monthly HOA ($):</label>
      <input type="number" id="hoa" placeholder="e.g. 200">

      <button onclick="calculate()">Calculate</button>
      <button class="clear" onclick="clearForm()">Clear</button>
    </div>

    <div class="results" id="results" style="display:none;">
      <h2>üí∞ Results</h2>
      <p><b>Loan Amount:</b> $<span id="loan_amount"></span></p>
      <p><b>Interest Rate:</b> <span id="interest_rate"></span>%</p>
      <p><b>Monthly Payment:</b> $<span id="monthly_payment"></span></p>
      <canvas id="chart" width="300" height="300"></canvas>
    </div>
  </div>

  <script>
    function updateTerms() {
      const type = document.getElementById("loan_type").value;
      const term = document.getElementById("loan_term");
      term.innerHTML = "";
      const terms = type === "Conventional" ? [30, 20, 15, 10] : [3, 5, 7, 10];
      terms.forEach(y => {
        const opt = document.createElement("option");
        opt.value = y;
        opt.text = y + " years";
        term.appendChild(opt);
      });
    }

    async function calculate() {
      const payload = {
        zipcode: document.getElementById("zipcode").value,
        home_value: document.getElementById("home_value").value,
        down_payment_value: document.getElementById("down_payment_value").value,
        down_payment_type: document.querySelector('input[name="dp_type"]:checked').value,
        loan_type: document.getElementById("loan_type").value,
        loan_term: document.getElementById("loan_term").value,
        property_tax: document.getElementById("property_tax").value,
        pmi: document.getElementById("pmi").value,
        home_ins: document.getElementById("home_ins").value,
        hoa: document.getElementById("hoa").value
      };
      const res = await fetch("/calculate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      const data = await res.json();

      document.getElementById("loan_amount").textContent = data.loan_amount;
      document.getElementById("interest_rate").textContent = data.interest_rate;
      document.getElementById("monthly_payment").textContent = data.monthly_payment;
      document.getElementById("results").style.display = "block";

      const ctx = document.getElementById("chart").getContext("2d");
      new Chart(ctx, {
        type: "pie",
        data: {
          labels: ["Principal+Interest", "Tax+Insurance+PMI+HOA"],
          datasets: [{
            data: [data.monthly_payment * 0.7, data.monthly_payment * 0.3]
          }]
        }
      });
    }

    function clearForm() {
      document.querySelectorAll("input").forEach(i => i.value = "");
      document.getElementById("results").style.display = "none";
    }

    updateTerms();
  </script>
</body>
</html>
