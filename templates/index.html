<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mortgage Calculator 2.0</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="container">
    <h1>Smart Mortgage Calculator</h1>

    <form method="POST">
        <div class="grid">

            <label>Home Value ($):</label>
            <input type="number" name="home_value" min="0" required>

            <label>Down Payment:</label>
            <div class="down-wrapper">
                <input type="number" name="down_payment" min="0" required>
                <select name="down_type">
                    <option value="$"> $ </option>
                    <option value="%"> % </option>
                </select>
            </div>

            <label>Loan Type:</label>
            <select name="loan_type" id="loan_type">
                <option value="Conventional">Conventional</option>
                <option value="ARM">Adjustable Rate Mortgage (ARM)</option>
            </select>

            <label>Loan Term (years):</label>
            <select name="loan_term" id="loan_term">
                <option value="30">30-Year</option>
                <option value="20">20-Year</option>
                <option value="15">15-Year</option>
                <option value="10">10-Year</option>
            </select>

            <label>Interest Rate (%):</label>
            <input type="number" step="0.01" name="interest_rate" min="0" value="5">

            <label>Property Tax ($/yr):</label>
            <input type="number" name="property_tax" min="0" value="3000">

            <label>Home Insurance ($/yr):</label>
            <input type="number" name="home_ins" min="0" value="1500">

            <label>Monthly HOA ($):</label>
            <input type="number" name="hoa" min="0" value="0">

            <button type="submit">Calculate</button>
        </div>
    </form>

    {% if result %}
    <div class="results">
        <h2>Mortgage Summary</h2>
        <p><strong>Loan Amount:</strong> ${{ result.loan_amount }}</p>
        <p><strong>Total Monthly Payment:</strong> ${{ result.monthly_payment }}</p>
        {% if result.pmi_msg %}
        <p class="pmi-msg">{{ result.pmi_msg }}</p>
        {% endif %}

        <h3>Current Rates</h3>
        <ul>
            <li>30-Year Fixed: {{ rates["30_yr_fixed"] }}%</li>
            <li>20-Year Fixed: {{ rates["20_yr_fixed"] }}%</li>
            <li>15-Year Fixed: {{ rates["15_yr_fixed"] }}%</li>
            <li>10-Year Fixed: {{ rates["10_yr_fixed"] }}%</li>
            <li>5/1 ARM: {{ rates["5_1_ARM"] }}%</li>
        </ul>

        <canvas id="chart"></canvas>
        <script>
            const ctx = document.getElementById('chart');
            const data = {
                labels: {{ chart_data.keys() | list | tojson }},
                datasets: [{
                    data: {{ chart_data.values() | list | tojson }},
                    backgroundColor: ['#4e79a7','#f28e2b','#e15759','#76b7b2','#59a14f']
                }]
            };
            new Chart(ctx, { type: 'pie', data: data, options: { responsive: true } });
        </script>
    </div>
    {% endif %}
</div>
</body>
</html>
