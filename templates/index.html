<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mortgage Calculator 2.0</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <h1>Smart Mortgage Calculator</h1>

        <form method="POST">
            <div class="grid">
                <label>ZIP Code:</label>
                <input type="text" name="zipcode" required>

                <label>Home Value ($):</label>
                <input type="number" name="home_value" min="0" required>

                <label>Down Payment ($):</label>
                <input type="number" name="down_payment" min="0" required>

                <label>Interest Rate (%):</label>
                <input type="number" step="0.01" name="interest_rate" min="0" required>

                <label>Loan Term (years):</label>
                <input type="number" name="loan_term" min="0" value="30">

                <label>Property Tax ($/yr):</label>
                <input type="number" name="property_tax" min="0" value="3000">

                <label>Home Insurance ($/yr):</label>
                <input type="number" name="home_ins" min="0" value="1500">

                <label>PMI (%):</label>
                <input type="number" step="0.01" name="pmi" min="0" value="0.5">

                <label>Monthly HOA ($):</label>
                <input type="number" name="hoa" min="0" value="0">

                <button type="submit">Calculate</button>
            </div>
        </form>

        {% if result %}
        <div class="results">
            <h2>Mortgage Summary</h2>
            <p><strong>Loan Amount:</strong> ${{ result.loan_amount }}</p>
            <p><strong>Total Monthly Payment:</strong> ${{ result.monthly_payment }}</p>

            <h3>Current Rates for ZIP {{ result.zipcode }}</h3>
            <ul>
                <li>30-Year Fixed: {{ result.rates["30_yr_fixed"] }}%</li>
                <li>15-Year Fixed: {{ result.rates["15_yr_fixed"] }}%</li>
                <li>5/1 ARM: {{ result.rates["5_1_ARM"] }}%</li>
            </ul>

            {% if chart_data %}
            <canvas id="chart"></canvas>

            <script>
                const ctx = document.getElementById('chart');
                const data = {
                    labels: {{ chart_data.keys() | list | tojson }},
                    datasets: [{
                        data: {{ chart_data.values() | list | tojson }},
                        backgroundColor: ['#4e79a7','#f28e2b','#e15759','#76b7b2','#59a14f']
                    }]
                };
                new Chart(ctx, { 
                    type: 'pie', 
                    data: data,
                    options: { responsive: true }
                });
            </script>
            {% endif %}
        </div>
        {% endif %}
    </div>
</body>
</html>
